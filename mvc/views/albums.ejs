<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <link rel="stylesheet" href="/static/css/css.css">
  <link rel="stylesheet" href="/static/css/bootstrap.min.css">
  <script src="/static/js/jquery-1.11.0.min.js"></script>
  <script src="/static/js/promise.min.js"></script>
  <script>
  //创建图片加载模型
   function modelLoadPhoto(i,folder) {
        return new Promise(function(resolve, reject) {
           setTimeout(function(){
              $.get('./single/'+folder,function(result){
                if(result.file!=''){
                  $(".eachphoto").eq(i).attr("src",result.file);
                  $(".eachfdcount").eq(i).html('&nbsp; ( '+result.len+' )');
                }else{
                   $(".eachphoto").eq(i).attr("src",'/static/images/folders.jpg');
                   $(".eachfdcount").eq(i).text('');
                }
            });
           },2000);
        });
   };

  $(function(){

      //定义1个任务进度
     var alltask = [];

     //注入任务
     $(".eachphoto").each(function(i){ 
        var folder =  $(".eachphoto").eq(i).attr("folder");
        alltask.push(modelLoadPhoto(i,folder));
     });
     
     //执行队列
     Promise.all(alltask).then(function(){});

  });
  </script>
</head>
<body>
  <%-include("menu",{folder:'share'})%>
  <div class="jumbotron alert alert-warning">
    <div class="container">
 <%for(var i=0;i<folders.length;i++){%>
      <div class="col-md-2 photos">
        <a href="/photos/<%=folders[i]%>">
           <img class='eachphoto' folder="<%=folders[i]%>" title="<%=folders[i]%>" src="/static/images/loading.gif" style="width:80px;"><br/>
          
        </a>
         <div class="badge"><%=folders[i]%><span class="eachfdcount"></span></div>
        <a href="/upload/<%=folders[i]%>" class="btn btn-sm btn-success upload">Upload</a>
      </div>
      <%}%>
    </div>
  </div>
</body>
</html>